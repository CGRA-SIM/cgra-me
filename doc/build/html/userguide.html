
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>User Guide &#8212; CGRA-ME 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Limitation" href="limitation.html" />
    <link rel="prev" title="Getting Started" href="gettingstarted.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="user-guide">
<span id="userguide-label"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cmake-build">
<span id="cmake-build-label"></span><h2>CMake Build<a class="headerlink" href="#cmake-build" title="Permalink to this headline">¶</a></h2>
<p>The build method in the <a class="reference internal" href="gettingstarted.html#gettingstarted-label"><span class="std std-ref">Getting Started</span></a> guide uses Makefile. The Makefile used is just a wrapper to the internal CMake. A more advanced user can use CMake directly to build the project.</p>
<p>Set-up as the <a class="reference internal" href="gettingstarted.html#installation-label"><span class="std std-ref">Installation</span></a> guide step one to step six suggested.
<cite>$ cd build</cite> and run <cite>$ cmake &lt;your-options&gt; ..</cite></p>
<div class="section" id="cmake-possible-options">
<h3>CMake Possible Options<a class="headerlink" href="#cmake-possible-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-DBUILD_LLVM_PASSES=&lt;value&gt;</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> can either be <code class="docutils literal notranslate"><span class="pre">ON</span></code> or <code class="docutils literal notranslate"><span class="pre">OFF</span></code> to either enable or disable the building of the llvm loop extraction pass.</dd>
</dl>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Refer to <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">CMake’s website</a> for CMake options, also reference <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html">CMake’s website on variables</a> for CMake variables that you want to modify.</p>
</div>
</div>
</div>
<div class="section" id="loop-dfg-generation">
<span id="dfg-generation-label"></span><h2>Loop DFG Generation<a class="headerlink" href="#loop-dfg-generation" title="Permalink to this headline">¶</a></h2>
<p>The user can create their own benchmarks that they want to map to different CGRA architectures. Here is the way of doing that.</p>
<div class="section" id="generate-user-custom-dfg">
<h3>Generate User Custom DFG<a class="headerlink" href="#generate-user-custom-dfg" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Create a new directory in benchmark/userbench directory with the same name as the name of your benchmark source file.</li>
<li>Create a new file with the name Makefile in the new directory you created.</li>
<li><a class="reference internal" href="#source-code-requirement-label"><span class="std std-ref">Modify</span></a> your source code and include the <a class="reference internal" href="#dfg-loop-tag-label"><span class="std std-ref">DFG Loop Tag</span></a> in the loop of your interest.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are limitations to what kind of loop can generate DFG and be mapped. Limitations are explained in <a class="reference internal" href="limitation.html#dfg-generation-limitation-label"><span class="std std-ref">DFG Generation Limitation</span></a>.</p>
</div>
<ol class="arabic simple" start="4">
<li>Add necessary <a class="reference internal" href="#dfg-generation-options-label"><span class="std std-ref">DFG Generation Options</span></a>, including compiler flags and flags to indicate which loop to generate the DFG for.</li>
<li>Put line: <cite>include ../rules.mk</cite> at the end of the Makefile and save the file.</li>
<li>Run <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">make</span></code> in the current directory and the DFG with be generated.</li>
</ol>
</div>
<div class="section" id="dfg-generation-options">
<span id="dfg-generation-options-label"></span><h3>DFG Generation Options<a class="headerlink" href="#dfg-generation-options" title="Permalink to this headline">¶</a></h3>
<p>Put the following DFG Generation options in the beginning of your Makefile to configure it to generate DFG.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">LOOP_TAGS=&lt;tags&gt;</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">&lt;tags&gt;</span></code> are your loop tags for the loop that you want to generate DFG for. (If you want to generate a DFG for more than one loop, separate the loop tags by space.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DFG_FLAGS=&lt;flags&gt;</span></code></dt>
<dd>There are two possible options for <code class="docutils literal notranslate"><span class="pre">&lt;flags&gt;</span></code>, they are <code class="docutils literal notranslate"><span class="pre">-no-phi-removal</span></code> to prevent phi node removal and <code class="docutils literal notranslate"><span class="pre">-no-leaf-removal</span></code> to prevent the removal of useless leaf nodes (including comparison nodes). These two flags are both not enabled by default to generate mappable DFGs.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CFLAGS=&lt;flags&gt;</span></code></dt>
<dd>The <code class="docutils literal notranslate"><span class="pre">&lt;flags&gt;</span></code> will be directly passed to clang compiler. Reference to <a class="reference external" href="https://clang.llvm.org/docs/ClangCommandLineReference.html">Clang documentation</a> for possible flags.</dd>
</dl>
</div>
<div class="section" id="source-code-requirement">
<span id="source-code-requirement-label"></span><h3>Source Code Requirement<a class="headerlink" href="#source-code-requirement" title="Permalink to this headline">¶</a></h3>
<p>Some modifications might be required for the DFG generation process to take place correctly. Before modifying any code, you have to have a clear understanding of which functions should be inlined and which functions should not be inlined.</p>
<ol class="arabic simple">
<li>This DFG generation software can only support single C source file with header files. Make sure every thing that you want to map to a single source file.</li>
<li>All the functions that contains within your loop of interest should be inlined. You must add <code class="docutils literal notranslate"><span class="pre">__attribute__((always_inline))</span></code> to the functions and put the definitions in the corresponding header file.</li>
<li>All the functions that contains your loop of interest should not be inlined. You must add <code class="docutils literal notranslate"><span class="pre">__attribute__((noinline))</span></code> to the functions and put the definitions in the source file.</li>
</ol>
</div>
<div class="section" id="dfg-loop-tag">
<span id="dfg-loop-tag-label"></span><h3>DFG Loop Tag<a class="headerlink" href="#dfg-loop-tag" title="Permalink to this headline">¶</a></h3>
<p>For all the loops that you want to generate DFGs for, you have to add special tags to them.</p>
<p>In the first line of the loop, add <code class="docutils literal notranslate"><span class="pre">//DFGLOOP:</span> <span class="pre">&lt;tag&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;</span></code> is an arbitrary name you given to the loop, which will be referenced use to reference in <a class="reference internal" href="#dfg-generation-options-label"><span class="std std-ref">DFG Generation Options</span></a>. Please look at any of the microbench examples if you are not sure about how it is done.</p>
</div>
</div>
</div>
<div class="section" id="xml-user-guide">
<h1>XML User Guide<a class="headerlink" href="#xml-user-guide" title="Permalink to this headline">¶</a></h1>
<p>The XML language provides a platform for CGRA architects to create relatively simple designs quickly and gives an easy way to visualize the architecture you are creating.</p>
<div class="section" id="language-format">
<h2>Language Format<a class="headerlink" href="#language-format" title="Permalink to this headline">¶</a></h2>
<p>The following is a high level description of each tags functionality</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>&lt;cgra&gt;</dt>
<dd><ul class="first last">
<li>This tag begins the document. You must open and close the document with this tag.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&lt;definition …./&gt;</dt>
<dd><ul class="first last">
<li>Allows you to create variables. Similar to the #definition tag in c++</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&lt;module name=”…”&gt;</dt>
<dd><ul class="first last">
<li>A module can be thought of as a black box you can refer to by name. It contains inputs, outputs and bidirectionals that are connected to a series of processing elements on the inside.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&lt;architecture&gt;</dt>
<dd><ul class="first last">
<li>The architecture is the physical layout of all of the modules. Here you describe the position of each module and how each module connects to each other module</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="generic-document-structure">
<h2>Generic Document Structure<a class="headerlink" href="#generic-document-structure" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cgra&gt;</span>

        <span class="nt">&lt;definition..../&gt;</span>

        <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- stuff --&gt;</span>
        <span class="nt">&lt;/module&gt;</span>

        <span class="nt">&lt;architecture</span> <span class="na">rows=</span><span class="s">&quot;n&quot;</span> <span class="na">cols=</span><span class="s">&quot;m&quot;</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- stuff --&gt;</span>
        <span class="nt">&lt;/architecture&gt;</span>
<span class="nt">&lt;/cgra&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-module">
<h2>Creating a Module<a class="headerlink" href="#creating-a-module" title="Permalink to this headline">¶</a></h2>
<div class="section" id="naming-a-module">
<h3>Naming a module<a class="headerlink" href="#naming-a-module" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>When you create a <em>block</em> in the architecture, you must fill it with a module with a name. How to do this is found in the <em>Describing the Architecture</em> section. The following code describes how to assign a name to a module that can be used later inside the architecture.</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;genericname&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- module contents --&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-inputs-outputs-inouts">
<h3>Adding inputs/outputs/inouts<a class="headerlink" href="#adding-inputs-outputs-inouts" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Each module must have inputs, outputs, or bidirectionals (inouts) so that it is able to connect to surrounding modules in the architecture. Each input/output/inout has a name so it can be referred to later on in both the module and architecture. The following code describes how to add input and output ports.</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;genericname&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;input&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">&quot;output&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;inout</span> <span class="na">name=</span><span class="s">&quot;inout&quot;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- more stuff --&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>These ports can be referred to within the architecture by this.*port name*</li>
</ul>
</div>
<div class="section" id="adding-an-instance">
<h3>Adding an instance<a class="headerlink" href="#adding-an-instance" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Inside each module, you can create instances of different processing elements, each with its own set of inputs and outputs. You can refer to a PEs inputs and outputs using a name which you assign to each PE. The currently supported PEs with their corresponding XML arguments are:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>FuncUnit</dt>
<dd><ul class="first last">
<li>‘op’ refers to the operations supported by the unit separated by whitespace (more info can be found in the c++ user guide on this). This defaults to add sub</li>
<li>‘size’ refers to the bit width of the operands. This defaults to 32</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>MEMUnit</dt>
<dd><ul class="first last">
<li>none</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Register</dt>
<dd><ul class="first last">
<li>‘size’ refers to the bit width of the register This defaults to 32</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Multiplexer</dt>
<dd><ul class="first last">
<li>‘ninput’ refers to the number of inputs</li>
<li>‘size’ refers to the bit width of the inputs. This defaults to 32</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Tristate</dt>
<dd><ul class="first last">
<li>‘size’ refers to the bit width of the inputs. This defaults to 32</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>IO</dt>
<dd><ul class="first last">
<li>‘size’ refers to the bit width of the inputs. This defaults to 32</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>RegisterFile</dt>
<dd><ul class="first last">
<li>‘ninput’ refers to the number of input ports to the register file</li>
<li>‘noutput’ refers to the number of output ports from the register file</li>
<li>‘log2-nregister’ refers to the log base 2 of the number of items the refister can hold</li>
<li>‘size’ refers to the bit width of each item. This defaults to 32</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The inputs and outputs of each PE can be found in the C++ documentation</p>
</li>
<li><p class="first">The following is an example of how to add an instance to your architecture</p>
</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;genericname&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;inst</span> <span class="na">module=</span><span class="s">&quot;FuncUnit&quot;</span> <span class="na">name=</span><span class="s">&quot;func&quot;</span> <span class="na">op=</span><span class="s">&quot;add sub mul&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>A description of the functionality of each PE can be found in the C++ API documentation</li>
</ul>
</div>
<div class="section" id="adding-a-wire">
<h3>Adding a wire<a class="headerlink" href="#adding-a-wire" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A wire is equivalent to a port. It provides an intermediary step for connections.</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;genericname&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;input&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">&quot;output&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;inout</span> <span class="na">name=</span><span class="s">&quot;inout&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;wire</span> <span class="na">name=</span><span class="s">&quot;wire&quot;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- more stuff --&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-connection">
<h3>Adding a connection<a class="headerlink" href="#adding-a-connection" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>Connections can be made between ports. The connection must have an attribute describing where it is coming from and where it is going. The currently supported attributes are:</dt>
<dd><ul class="first last">
<li>to - connects some input(s) to one output</li>
<li>from - connect one input to some output(s)</li>
<li>select-from - takes multiple inputs as arguments and muxes them to one output</li>
<li>distribute-to- distributes 1 input to many outputs (no muxes)</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;genericname&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;input&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">&quot;output&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;inout</span> <span class="na">name=</span><span class="s">&quot;inout&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;wire</span> <span class="na">name=</span><span class="s">&quot;wire&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;this.input&quot;</span> <span class="na">to=</span><span class="s">&quot;wire&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;wire&quot;</span> <span class="na">to=</span><span class="s">&quot;this.output&quot;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- more stuff --&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="describing-the-architecture">
<h2>Describing the Architecture<a class="headerlink" href="#describing-the-architecture" title="Permalink to this headline">¶</a></h2>
<div class="section" id="patterns">
<h3>Patterns<a class="headerlink" href="#patterns" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Patterns allow the user to easily create a repeated tile layout on the grid</li>
<li>The <strong>row-range</strong> and <strong>col-range</strong> attributes define which rows and columns to operate on. The <strong>row</strong> and <strong>col</strong> attributes define how many blocks are occupied by 1 instance of the pattern (they default to 1 if left out)</li>
<li>The current pattern position iterates from left to right, and moves down to the next row when there are no more columns over which to iterate in the described area</li>
<li>The language currently does not support creating connections with <strong>row</strong> and <strong>col</strong> attributes not equal to 1</li>
</ul>
</div>
<div class="section" id="creating-a-pattern-without-the-row-and-col-attributes">
<h3>Creating a pattern without the <strong>row</strong> and <strong>col</strong> attributes<a class="headerlink" href="#creating-a-pattern-without-the-row-and-col-attributes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The following code is an example of creating a pattern for which each position on the grid is filled with a block containing a module</li>
<li>Here, I have created a 3x3 grid and am operating on all positions (counting starts at 0 for row-range and col-range)</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;architecture</span> <span class="na">rows=</span><span class="s">&quot;3&quot;</span> <span class="na">cols=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pattern</span> <span class="na">row-range=</span><span class="s">&quot;0 2&quot;</span> <span class="na">col-range=</span><span class="s">&quot;0 2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;module&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/pattern&gt;</span>
<span class="nt">&lt;/architecture&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-pattern-with-the-row-and-col-attributes">
<h3>Creating a pattern with the <strong>row</strong> and <strong>col</strong> attributes<a class="headerlink" href="#creating-a-pattern-with-the-row-and-col-attributes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>When you use these attributes, you are creating a set of blocks that will be repeatedly stamped out. Each of these blocks takes up space on the grid. When you declare the blocks inside the pattern, you add blocks from left to right, top to bottom in the space defined by the pattern.</li>
<li>The following example is a creation of a pattern using the <strong>row</strong> and <strong>col</strong> attributes.</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;architecture</span> <span class="na">rows=</span><span class="s">&quot;8&quot;</span> <span class="na">cols=</span><span class="s">&quot;8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pattern</span> <span class="na">row-range=</span><span class="s">&quot;0 7&quot;</span> <span class="na">col-range=</span><span class="s">&quot;0 7&quot;</span> <span class="na">row=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;A&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- row break --&gt;</span>
        <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;C&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;D&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/pattern&gt;</span>
<span class="nt">&lt;/architecture&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="counters">
<h3>Counters<a class="headerlink" href="#counters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In this language, there are 3 types of counters: <strong>counter, row-counter, col-counter</strong></li>
<li>Each counter starts at 0 and increases by 1 each time you move to the next instance of a pattern <strong>note: double check this</strong></li>
<li><dl class="first docutils">
<dt>The counter</dt>
<dd><ul class="first last">
<li>Each time you move to the next instance of a pattern stamp, this counter will increment by 1. It never resets to 0</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The row-counter</dt>
<dd><ul class="first last">
<li>This counter starts at 0 and increments by 1 every time you move to a new row within the pattern</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The col-counter</dt>
<dd><ul class="first last">
<li>This counter starts at 0 and increments every time you move to the next column in a pattern. If the current grid position moves to a new row, this counter gets reset to 0</li>
</ul>
</dd>
</dl>
</li>
<li>The following is an example of how to use these counters</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;architecture</span> <span class="na">rows=</span><span class="s">&quot;3&quot;</span> <span class="na">cols=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pattern</span> <span class="na">row-range=</span><span class="s">&quot;0 2&quot;</span> <span class="na">col-range=</span><span class="s">&quot;0 2&quot;</span> <span class="na">counter=</span><span class="s">&quot;i&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;(rel 0 0).portname&quot;</span> <span class="na">to=</span><span class="s">&quot;(rel 0 -(i)).portname&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/pattern&gt;</span>
<span class="nt">&lt;/architecture&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>NOTE: When using the counter, you must give it a name. Here, I have given it the name ‘i’. Ensure that the name of the counter is just 1 character.</li>
<li>When you would like to use the counter to represent a number, you must enclose it in brackets. For example, if the value of the counter named ‘i’ is 5, (i) will become 5 in the code above.</li>
</ul>
</div>
<div class="section" id="wrap-around">
<h3>Wrap-Around<a class="headerlink" href="#wrap-around" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The language supports the ability to ‘wrap-around’. This means that if I create a pattern that will be created between columns 0 to 2, and I refer to a column that is outside of these bounds, the language will use the modulus operator to refer to a block that lies within the pattern instead if this feature is activated. Here is an example with wrap-around ON</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;architecture</span> <span class="na">rows=</span><span class="s">&quot;3&quot;</span> <span class="na">cols=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pattern</span> <span class="na">row-range=</span><span class="s">&quot;0 2&quot;</span> <span class="na">col-range=</span><span class="s">&quot;0 2&quot;</span> <span class="na">wrap-around=</span><span class="s">&quot;on&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;(rel 0 0).portname&quot;</span> <span class="na">to=</span><span class="s">&quot;(rel 0 3).portname&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/pattern&gt;</span>
<span class="nt">&lt;/architecture&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>In this example, if the current working grid position is 0, 0, (rel 0 3) will refer to 0, 0. This is because normally, (rel 0 3) would refer to block 0, 3 and this block is outside of the pattern range. Instead of referring to block 0, 3, the language treats this as block 0, 1 because it has ‘wrapped around’ the current pattern.</li>
<li>This feature defaults to OFF</li>
</ul>
</div>
<div class="section" id="inter-block-connections">
<h3>Inter-Block connections<a class="headerlink" href="#inter-block-connections" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Connections can be made between blocks in the architecture with patterns. You can refer to the block to which you would like to connect not by its absolute position on the grid, but by its relative position to the current position on the grid. An example of such a connection is as follows:</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;(rel a b)&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>Here, <strong>a</strong> and <strong>b</strong> are placeholders for integers. <strong>a</strong> represents the row offset (downward is positive) and <strong>b</strong> the column offset (to the right is positive). For example, (rel 0 0) refers to the current grid position, and (rel 1 1) refers to a position 1 down and 1 to the right of the current grid position.</li>
<li>The following is an example of a pattern that connects each block to the block to its right</li>
<li><dl class="first docutils">
<dt>To refer to a blocks port (input/output/inout), use the following format:</dt>
<dd><ul class="first last">
<li>blockname.portname</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;architecture</span> <span class="na">rows=</span><span class="s">&quot;8&quot;</span> <span class="na">cols=</span><span class="s">&quot;8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pattern</span> <span class="na">row-range=</span><span class="s">&quot;0 7&quot;</span> <span class="na">col-range=</span><span class="s">&quot;0 6&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;(rel 0 1).portname&quot;</span> <span class="na">to=</span><span class="s">&quot;(rel 0 0).portname&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/pattern&gt;</span>
<span class="nt">&lt;/architecture&gt;</span>
</pre></div>
</div>
<p>Referring to individual blocks</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;block_a_b_.portname&quot;</span> <span class="na">to=</span><span class="s">&quot;(rel 0 0).portname&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>Here, <strong>a</strong> represents the row and <strong>b</strong> represents the column of the desired block (counting starts at 1)</li>
</ul>
</div>
<div class="section" id="syntactic-sugar">
<h3>Syntactic Sugar<a class="headerlink" href="#syntactic-sugar" title="Permalink to this headline">¶</a></h3>
<p>Some designs for a CGRA are quite common, so as a part of the language we have added syntactic sugar to make these common designs easy to represent. These common designs are listed below…</p>
<p><strong>NSWE Mesh:</strong> On the grid, this architecture consists of IOs along every side of the grid (but not in the corners), and the interior entirely filled with PEs. Each PE connects to each other via north, south, east and west connections. For example, the east input/output of one PE will be connected to the west output/input of the PE to its east, the north input/output of the PE will be connected to the south output/input of the PE to its north, etc. The following code is an example of how to create such an architecture:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;architecture</span> <span class="na">col=</span><span class="s">&quot;4&quot;</span> <span class="na">row=</span><span class="s">&quot;4&quot;</span> <span class="na">cgra-cols=</span><span class="s">&quot;2&quot;</span> <span class="na">cgra-rows=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mesh</span> <span class="na">out-north=</span><span class="s">&quot;.out&quot;</span>
              <span class="na">out-east=</span><span class="s">&quot;.out&quot;</span>
              <span class="na">out-west=</span><span class="s">&quot;.out&quot;</span>
              <span class="na">out-south=</span><span class="s">&quot;.out&quot;</span>
              <span class="na">in-north=</span><span class="s">&quot;.in0&quot;</span>
              <span class="na">in-east=</span><span class="s">&quot;.in1&quot;</span>
              <span class="na">in-west=</span><span class="s">&quot;.in2&quot;</span>
              <span class="na">in-south=</span><span class="s">&quot;.in3&quot;</span>
              <span class="na">io=</span><span class="s">&quot;every-side-port&quot;</span>
              <span class="nt">&gt;</span>
          <span class="nt">&lt;interior</span> <span class="na">row=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;block1&quot;</span> <span class="na">mode=</span><span class="s">&quot;add sub mul div and or xor shl shr sshr&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/interior&gt;</span>
        <span class="nt">&lt;/mesh&gt;</span>
      <span class="nt">&lt;/architecture&gt;</span>
</pre></div>
</div>
<p>You must include the out-north, etc attributes in the mesh tag to determine which ports in each PE you would like to use for the north, south, west and east ports.</p>
<p>There are a few things to note about this functionality that haven’t been mentioned. When using the <em>mesh</em> tag, you must include the <em>cgra-cols</em> and <em>cgra-rows</em> attributes to the architecture. This determines how many rows and columns to use for the PEs in the mesh, and how many to leave for the IOs. Generally, leave 2 rows and 2 columns for the IOs.</p>
<p>The second thing to note is the <em>interior</em> tag. This tag functions similarly to <em>pattern</em>. It determines which block(s) to fill the interior of the cgra design with. You can use the <strong>row</strong> and <strong>col</strong> attributes here in the same way as described above.</p>
<p><strong>NSWE + Diagonal Mesh:</strong> This is almost exactly the same as the NSWE Mesh, except this includes the northeast, northwest, southeast, southwest connections (note: there are still no IOs in the corners of the grid). An example of how to create such an architecture is below.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>  <span class="nt">&lt;architecture</span> <span class="na">col=</span><span class="s">&quot;4&quot;</span> <span class="na">row=</span><span class="s">&quot;4&quot;</span> <span class="na">cgra-cols=</span><span class="s">&quot;2&quot;</span> <span class="na">cgra-rows=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;diagonal</span> <span class="na">out-north=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">out-east=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">out-west=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">out-south=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">out-northeast=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">out-northwest=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">out-southeast=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">out-southwest=</span><span class="s">&quot;.out&quot;</span>
            <span class="na">in-north=</span><span class="s">&quot;.in0&quot;</span>
            <span class="na">in-east=</span><span class="s">&quot;.in1&quot;</span>
            <span class="na">in-west=</span><span class="s">&quot;.in2&quot;</span>
            <span class="na">in-south=</span><span class="s">&quot;.in3&quot;</span>
            <span class="na">in-northeast=</span><span class="s">&quot;.in4&quot;</span>
            <span class="na">in-northwest=</span><span class="s">&quot;.in5&quot;</span>
            <span class="na">in-southeast=</span><span class="s">&quot;.in6&quot;</span>
            <span class="na">in-southwest=</span><span class="s">&quot;.in7&quot;</span>
            <span class="na">io=</span><span class="s">&quot;every-side-port&quot;</span>
            <span class="nt">&gt;</span>
    <span class="nt">&lt;interior</span> <span class="na">row=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;block1&quot;</span> <span class="na">mode=</span><span class="s">&quot;add sub mul div and or xor shl shr sshr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/interior&gt;</span>
  <span class="nt">&lt;/diagonal&gt;</span>
<span class="nt">&lt;/architecture&gt;</span>
</pre></div>
</div>
<p>Note that instead of using the <em>mesh</em> tag, the <em>diagonal</em> tag is used instead. Everything else is consistent with <em>mesh</em>.</p>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Creating a NSWE Mesh of functional units with syntactic sugar</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cgra&gt;</span>
  <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;block1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;in0&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;in1&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;in2&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;in3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">&quot;out&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;inst</span> <span class="na">name=</span><span class="s">&quot;func&quot;</span> <span class="na">module=</span><span class="s">&quot;FuncUnit&quot;</span> <span class="na">op=</span><span class="s">&quot;add sub mul div and or xor shl shr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;inst</span> <span class="na">name=</span><span class="s">&quot;register&quot;</span> <span class="na">module=</span><span class="s">&quot;Register&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;wire</span> <span class="na">name=</span><span class="s">&quot;in_a&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;wire</span> <span class="na">name=</span><span class="s">&quot;in_b&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;wire</span> <span class="na">name=</span><span class="s">&quot;func_out&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">select-from=</span><span class="s">&quot;this.in0 this.in1 this.in2 this.in3 register.out&quot;</span> <span class="na">to=</span><span class="s">&quot;in_a in_b&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;in_a&quot;</span> <span class="na">to=</span><span class="s">&quot;func.in_a&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;in_b&quot;</span> <span class="na">to=</span><span class="s">&quot;func.in_b&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">select-from=</span><span class="s">&quot;in_a in_b func.out&quot;</span> <span class="na">to=</span><span class="s">&quot;func_out&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">from=</span><span class="s">&quot;func_out&quot;</span> <span class="na">to=</span><span class="s">&quot;register.in&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;connection</span> <span class="na">select-from=</span><span class="s">&quot;func_out register.out&quot;</span> <span class="na">to=</span><span class="s">&quot;this.out&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/module&gt;</span>
  <span class="nt">&lt;architecture</span> <span class="na">col=</span><span class="s">&quot;4&quot;</span> <span class="na">row=</span><span class="s">&quot;4&quot;</span> <span class="na">cgra-cols=</span><span class="s">&quot;2&quot;</span> <span class="na">cgra-rows=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;mesh</span> <span class="na">out-north=</span><span class="s">&quot;.out&quot;</span>
          <span class="na">out-east=</span><span class="s">&quot;.out&quot;</span>
          <span class="na">out-west=</span><span class="s">&quot;.out&quot;</span>
          <span class="na">out-south=</span><span class="s">&quot;.out&quot;</span>
          <span class="na">in-north=</span><span class="s">&quot;.in0&quot;</span>
          <span class="na">in-east=</span><span class="s">&quot;.in1&quot;</span>
          <span class="na">in-west=</span><span class="s">&quot;.in2&quot;</span>
          <span class="na">in-south=</span><span class="s">&quot;.in3&quot;</span>
          <span class="na">io=</span><span class="s">&quot;every-side-port&quot;</span>
          <span class="nt">&gt;</span>
      <span class="nt">&lt;interior</span> <span class="na">row=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;block</span> <span class="na">module=</span><span class="s">&quot;block1&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/interior&gt;</span>
    <span class="nt">&lt;/mesh&gt;</span>
  <span class="nt">&lt;/architecture&gt;</span>
<span class="nt">&lt;/cgra&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="c-api-user-guide">
<h1>C++ API User Guide<a class="headerlink" href="#c-api-user-guide" title="Permalink to this headline">¶</a></h1>
<p>The C++ API provides a flexible platform for CGRA architects to create designs in c++ and determine whether or not certain benchmarks can be mapped to them.</p>
<div class="section" id="before-you-begin-coding">
<h2>Before you begin coding<a class="headerlink" href="#before-you-begin-coding" title="Permalink to this headline">¶</a></h2>
<p>Before you write any code, you must include the correct header files. These are as follows:</p>
<ul class="simple">
<li>&lt;CGRA/Module.h&gt;</li>
<li>&lt;CGRA/ModuleComposites.h&gt;</li>
<li>&lt;CGRA/CGRA.h&gt;</li>
<li>&lt;CGRA/ILPMapper.h&gt;</li>
<li>&lt;CGRA/OpGraph.h&gt;</li>
</ul>
<p>Include any other files you require</p>
</div>
<div class="section" id="basic-overview">
<h2>Basic Overview<a class="headerlink" href="#basic-overview" title="Permalink to this headline">¶</a></h2>
<p>When using the C++ API, there is an order of operations to follow which I will outline below.</p>
<div class="section" id="create-the-cgra-pointer">
<h3>1. Create the CGRA pointer.<a class="headerlink" href="#create-the-cgra-pointer" title="Permalink to this headline">¶</a></h3>
<p>The mapper takes in the pointer as an argument. Before you pass the pointer to the mapper, you must ‘fill’ it with the architecture</p>
</div>
<div class="section" id="adding-primitives">
<h3>2. Adding primitives.<a class="headerlink" href="#adding-primitives" title="Permalink to this headline">¶</a></h3>
<p>Here you add the different PEs which will make up the architecture.</p>
</div>
<div class="section" id="adding-connections">
<h3>3. Adding connections.<a class="headerlink" href="#adding-connections" title="Permalink to this headline">¶</a></h3>
<p>Here, you connect the PEs together. Connections are made between ports and each PE has its own ports with a naming convention, which will be described later.</p>
</div>
</div>
<div class="section" id="adding-the-cgra-pointer">
<h2>Adding the CGRA Pointer<a class="headerlink" href="#adding-the-cgra-pointer" title="Permalink to this headline">¶</a></h2>
<p>To add the CGRA pointer to your file, you use the following syntax:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CGRA</span><span class="o">&gt;</span> <span class="n">tempName</span><span class="p">(</span><span class="k">new</span> <span class="n">CGRA</span><span class="p">());</span>
</pre></div>
</div>
<p>Here, tempName is the name you would like to give to your pointer. This name will be used for the rest of the document.</p>
</div>
<div class="section" id="adding-processing-elements">
<h2>Adding Processing Elements<a class="headerlink" href="#adding-processing-elements" title="Permalink to this headline">¶</a></h2>
<p>Here is a list of the PEs that are available to add to your architecture:</p>
<p><strong>FuncUnit:</strong> This is a functional unit that performs LLVM computations. You can give it the ability to perform multiple operations of your choice. An extensive list of operations that it can perform is below. To add one to your architecture, use the following syntax (the types of each variable are included for clarity):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">FuncUnit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">OpGraphOpCode</span><span class="o">&gt;</span> <span class="n">supported_modes</span> <span class="o">=</span> <span class="p">{</span><span class="n">OPGRAPH_OP_ADD</span><span class="p">,</span> <span class="n">OPGRAPH_OP_MUL</span><span class="p">},</span> <span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">DEFAULT_SIZE</span><span class="p">));</span>
</pre></div>
</div>
<p>Be sure that no 2 functional units have the same name. The supported modes default to add and multiply. A full list can be found below. The size is the bit width of the operands and result.</p>
<dl class="docutils">
<dt>Ports:</dt>
<dd><ul class="first last simple">
<li>‘in_a’ is an input</li>
<li>‘in_b’ is an input</li>
<li>‘out’ is an output</li>
</ul>
</dd>
</dl>
<p><strong>MEMUnit (needs testing):</strong> The MEMUnit is a functional unit that only supports store and load operations. It can be called using the following syntax:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">MEMUnit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">DEFAULT_SIZE</span><span class="p">));</span>
</pre></div>
</div>
<p>The name and size arguments represent the same thing as they do in the FuncUnit.</p>
<dl class="docutils">
<dt>Ports:</dt>
<dd><ul class="first last simple">
<li>‘addr’ is the address to read or write to</li>
<li>‘data_in’ is the input data</li>
<li>‘data_out’ is the output data</li>
</ul>
</dd>
</dl>
<p><strong>Register:</strong> To add a register to your architecture, use the following syntax (variable types are included for clarity):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">Register</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">DEFAULT_SIZE</span><span class="p">));</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ports:</dt>
<dd><ul class="first last simple">
<li>‘in’ is the input data</li>
<li>‘out’ is the output data</li>
</ul>
</dd>
</dl>
<p><strong>Multiplexer:</strong> The multiplexer selects a single input as output from a choice of many inputs. It can be called using the following syntax (types are included for clarity):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">Multiplexer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">mux_size</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">DEFAULT_SIZE</span><span class="p">));</span>
</pre></div>
</div>
<p>Be sure that each mux has a unique name. The mux_size determines how many inputs the mux can take. The size is the bit width of the operands and defaults to 32.</p>
<dl class="docutils">
<dt>Ports:</dt>
<dd><ul class="first last simple">
<li>‘inN’ where N is replaced by the number of the input port you are refering to (counting starts at 0)</li>
<li>‘out’ is the output of the mux</li>
<li>‘select’ decides which input to take</li>
</ul>
</dd>
</dl>
<p><strong>RegisterFile:</strong> To add a register file to your architecture, use the following syntax (the variable types are included for clarity):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">RegisterFile</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">NumInputPorts</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">NumOutputPorts</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">Log2Registers</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">DEFAULT_SIZE</span><span class="p">));</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ports:</dt>
<dd><ul class="first last simple">
<li>‘inN’ refers to the Nth input port</li>
<li>‘address_inN’ refers to the Nth input address</li>
<li>‘WEN’ refers to the Nth write enable port</li>
<li>‘outN’ refers to the Nth output port</li>
<li>‘address_outN’ refers to the Nth port for output address</li>
</ul>
</dd>
</dl>
<p><strong>TriState:</strong> To add a new TriState to your architecture, use the following syntax (variable types are included for clarity):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">TriState</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">DEFAULT_SIZE</span><span class="p">));</span>
</pre></div>
</div>
<p><strong>IO:</strong> IO stands for input/output. It allows the CGRA to interact with external devices. It can be added to your architecture with the following syntax (types are included for clarity):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">IO</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">DEFAULT_SIZE</span><span class="p">));</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ports:</dt>
<dd><ul class="first last simple">
<li>‘in’ is the input port</li>
<li>‘out’ is the output port</li>
<li>‘bidir’ is the inout port</li>
</ul>
</dd>
</dl>
<p>Be sure the name of each IO is unique. The size is the bit width of the operands and defaults to 32.</p>
<p>Here is a list of operations that the FuncUnit can perform:</p>
<p><strong>nop</strong> - no operation</p>
<p><strong>trunc</strong> - truncate</p>
<p><strong>sext</strong> - sign extend</p>
<p><strong>phi</strong> - phi instruction</p>
<p><strong>add</strong> - add operands</p>
<p><strong>sub</strong> - subtract operands</p>
<p><strong>mul</strong> - multiply operands</p>
<p><strong>div</strong> - divide operands</p>
<p><strong>and</strong> - and operands</p>
<p><strong>or</strong> - or operands</p>
<p><strong>xor</strong> - xor operands</p>
<p><strong>shl</strong> - shift operand to left by some number</p>
<p><strong>shra</strong> - arithmetic shift right</p>
<p><strong>shrl</strong> - locigal shift right</p>
<p><strong>gep</strong> - get external pointer</p>
<p><strong>icmp</strong> - return boolean based on comparison of operands</p>
<p><strong>load</strong> - read from memory</p>
<p><strong>store</strong> - write to memory</p>
</div>
<div class="section" id="id1">
<h2>Adding Connections<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Each PE you add to the architecture has its own port names. The naming conventions are as follows:</p>
<p>When you connect PEs together in the architecture, you must make connections by port names. The following is the syntax for creating connections between PEs</p>
</div>
<div class="section" id="creating-your-own-processing-element">
<h2>Creating Your Own Processing Element<a class="headerlink" href="#creating-your-own-processing-element" title="Permalink to this headline">¶</a></h2>
<p>In the C++ API, we allow the user to create a “black box” with user defined functionality and naming conventions. The user is able to create their own processing element that can consist of a combination of the provided processing elements. The way this is done is as follows:</p>
<ol class="arabic simple">
<li>Create a class. This class must inherit from Module.</li>
<li>The constructor for your class is where the creation of the custom module happens. You must pass the “name” string to the Module constructor when you create your constructor. Other than that, you have the option to pass the “size” as a parameter (which is an integer that represents the bit width of the operands), but if left out it defaults to 32.</li>
<li>Add the modules to your design using the following syntax:</li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">yourModule</span><span class="p">(</span><span class="n">yourArgumens</span><span class="p">));</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Add the ports to your design. Your design should include input/output ports so that multiple instances of this design can be connected together later in the architecture. Your design can also include internal ports, which can be used as an intermediate when connecting PEs together. To add a port to your design, use the following syntax inside the constructor of your module:</li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">addPort</span><span class="p">(</span><span class="s">&quot;portName&quot;</span><span class="p">,</span> <span class="n">portType</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</pre></div>
</div>
<p>If you want to refer to the port you have just created inside the constructor, you can type <em>this.portName</em>. <em>portType</em> is a variable of type port_type and can be any of the following: PORT_INPUT, PORT)OUTPUT, PORT_OUTPUT_REG, PORT_BIDIR, PORT_UNSPECIFIED. The size is the bit width of the port and defaults to 32 if left out.</p>
<ol class="arabic simple" start="5">
<li>Add the internal connections. The connections between instances of your module will be made later in the architecture definition. Here, you must connect the PEs that exist within your module using the syntax outlined in the above sections.</li>
</ol>
<p>Once you have created your module, be sure to include its header file into your main architecture file. The following is an example of how to add an instance of your custom module to your code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">tempName</span><span class="o">-&gt;</span><span class="n">addSubModule</span><span class="p">(</span><span class="k">new</span> <span class="n">yourModule</span><span class="p">(</span><span class="n">yourArgumens</span><span class="p">));</span>
</pre></div>
</div>
<p>For an example of the C++ API being used, look at the <code class="docutils literal notranslate"><span class="pre">arch_mem_fu.cpp</span></code> file within src/archs. In there, you will find constructors for custom modules that use the C++ API.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">CGRA-ME</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cmake-build">CMake Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loop-dfg-generation">Loop DFG Generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#xml-user-guide">XML User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#language-format">Language Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generic-document-structure">Generic Document Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-module">Creating a Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#describing-the-architecture">Describing the Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#c-api-user-guide">C++ API User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#before-you-begin-coding">Before you begin coding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-overview">Basic Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-the-cgra-pointer">Adding the CGRA Pointer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-processing-elements">Adding Processing Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Adding Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-your-own-processing-element">Creating Your Own Processing Element</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="limitation.html">Limitation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="gettingstarted.html" title="previous chapter">Getting Started</a></li>
      <li>Next: <a href="limitation.html" title="next chapter">Limitation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, CGRA-ME.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/userguide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>